{% extends "subscription_pools/_base.html" %}
{% from "subscription_pool_elements/_macros.html" import elements_display %}
{% from "illusts/_macros.html" import illusts_display %}
{% from "posts/_macros.html" import recent_posts %}

{% block title %}
    {{ subscription_pool.header }}
{% endblock title %}

{% block content %}
    <div id="subscription-pool-heading" class="heading">{{ subscription_pool.header }}</div>
    <div id="subscription-pool-content">
        {% include "subscription_pools/_sidebar.html" %}
        {% include "subscription_pools/_site_content.html" %}
    </div>
    {{ elements_display(helpers.subscription_pool.element_search(subscription_pool), subscription_pool.element_count, 'subscription-elements') }}
    {{ illusts_display(helpers.subscription_pool.illust_search(subscription_pool), subscription_pool.illust_count, 'subscription-illusts', False) }}
    <div id="subscription-pool-posts">{{ recent_posts(subscription_pool.recent_posts, subscription_pool.post_count, helpers.subscription_pool.post_search(subscription_pool)) }}</div>
{% endblock content %}

{% block pagescript %}
    (function () {
    const pool_status = "{{ subscription_pool.status }}";
    const job_status = "{{ job_status['stage'] if job_status is not none else 'done' }}";
    const query_url = "{{ url_for('subscription_pool.status_json', id=subscription_pool.id, job=job_id) }}";
    SubscriptionPools.initializeReloadInterval(pool_status);
    SubscriptionPools.initializeJobQueryInterval(job_status, query_url);
    })();
{% endblock pagescript %}
